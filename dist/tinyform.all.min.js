/**
 * TinyForm-all@0.7.8  2018-01-13
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinyForm.git
 * @示例: http://hyjiacan.oschina.io/tinyform
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */
!function(a,b){function c(){return"tiny"+(new Date).getTime()+Math.random().toString().substring(2)}function d(a,e){var f=b(a).first(),g=f.attr("data-tinyform");return g&&h.hasOwnProperty(g)||(g=c(),f.attr("data-tinyform",g),h[g]=new d.prototype.setup(f,e,g)),h[g]}function e(a){var c=a.option,d=c.exclude;"string"==typeof d||d instanceof window.HTMLElement?c.exclude=b(d,a.context):d instanceof b||(c.exclude=!1),d=b(a.context).find("[data-exclude]"),d.length&&(c.exclude=d?c.exclude.concat(d):d)}function f(a){var c=i[a.id]={},e=b.makeArray(a.option.ignore);a.context.find(d.defaults.selector).each(function(){var d=b(this);if(!a.option.selector||d.is(a.option.selector)){var f=b.trim(d.attr("name"));if(""!==f&&e.indexOf(f)===-1&&!(a.option.exclude&&a.option.exclude.find(d).length>0))return void 0===c[f]||0===c[f].length?void(c[f]=d):d.is(":radio")?void c[f].push(this):void console.error('字段的name属性"'+f+'"出现多次，这不对吧')}})}var g={setup:[],refresh:[]},h={},i={};d.prototype={constructor:d,setup:function(a,c,h){var i=this;return i.id=h,i.context=a,i.option=b.extend(!0,{},d.defaults,c),e(i),f(i),b.each(g.setup,function(){this.call(i)}),i},getField:function(a){var c=b.extend(!0,{},i[this.id]);if(0===arguments.length)return c;if("string"==typeof a){var d=c[a];if(c.hasOwnProperty(a)&&0!==d.length)return d}},refresh:function(){var a=this;return f(a),b.each(g.refresh,function(){this.call(a)}),a}},Object.defineProperty(d,"extend",{configurable:!1,value:function(a){var c=this;b.each(a,function(a,b){return g.hasOwnProperty(a)?void g[a].push(b):c.hasOwnProperty(a)?void console.error("插件添加方法失败: 此方法已经存在"):void(d.prototype[a]=b)})}}),d.defaults={selector:"input[name]:not(:button,:submit,:reset,[data-ignore]"+(window.FormData?"":",[type=file]")+"), select[name]:not([data-ignore]), textarea[name]:not([data-ignore])",ignore:!1,exclude:!1},d.prototype.setup.prototype=d.prototype,a.TinyForm=d,d.get=function(a){return a?h[a]:b.extend(!0,{},h)}}(window,jQuery),function(a,b){function c(a,c,d){if(d&&0!==d.length)return c=g(c),c=b.isArray(c)?b.map(c,function(a){return a.toString()}):c.toString(),d.is(":radio")?void d.prop("checked",!1).each(function(){if(b(this).val().toLowerCase()===c.toLowerCase())return b(this).prop("checked",!0),!1}):d.is(":checkbox")?void d.prop("checked",c.toLowerCase()===a.option.checkbox[0].toString().toLowerCase()):void(d.is("select")?(d.val(c),d.change()):d.val(c))}function d(a){var c={};return b.each(a.getField(),function(b){c[b]=e(a,b)}),c}function e(a,b){var c=a.getField(b);if(!c)return console.error('cannot found field "'+b+'"'),"";if(c.is("input"))return f(a,c);var d=c.val();return c.is("select[multiple]")?null===d?[]:d:void 0===d?c.is("select[multiple]")?[]:"":d}function f(a,b){return b.is(":radio")?g(b.filter(":checked").val()):b.is(":checkbox")?b.is(":checked")?a.option.checkbox[0]:a.option.checkbox[1]:g(b.val())}function g(a,b){return void 0===a||null===a?arguments.length>1?b:"":a}var h=b.Deferred(),i={},j={};b.extend(!0,TinyForm.defaults,{checkbox:["on","off"],beforeSubmit:!1}),TinyForm.extend({setup:function(){i[this.id]=this.getData(),j[this.id]=this.getData()},getData:function(a){return 0===arguments.length?d(this):"string"!=typeof a?"":e(this,a)},setData:function(a,d){var e=this;if(0===arguments.length)return console.error("setData 需要至少1个参数"),e;if(arguments.length>=2&&"string"==typeof d)return c(e,a,e.getField(d)),e;var f="boolean"==typeof d;return arguments.length>=2&&!f?e:(b.each(e.getField(),function(b,d){if(!f||a.hasOwnProperty(b)){c(e,g(a[b]),d)}}),e)},asDefault:function(a){var b=this;return j[b.id]=arguments.length?a:b.getData(),b},getChanges:function(a){var c=this,d=j[c.id]||{},e={},f=c.getField();return b.each(c.getData(),function(b,c){d.hasOwnProperty(b)&&d[b]===c||(e[b]=a?f[b]:c)}),e},submit:function(a){var c=this;return a=b.extend({url:c.context.attr("action"),type:c.context.attr("method")||"post",async:!0,data:c.getData(),cache:!1},a),b.isFunction(c.option.beforeSubmit)&&c.option.beforeSubmit.call(c,a)===!1?h:b.ajax(a)},reset:function(){return b.isFunction(this.context.get(0).reset)?this.context.get(0).reset():this.setData(i[this.id]),this}})}(window,jQuery),function(a,b){TinyForm.defaults.upload={engine:"native",urL:!1,type:null,size:0,before:null,after:!1,progress:!1},TinyForm.extend({init:function(){var b=this;b.option.upload;if("native"===upload.engine&&!a.FormData)return void console.error("浏览器不支持 FormData，无法上传文件，请前往 http://caniuse.com/#search=formdata 查看浏览器兼容性")},upload:function(){}})}(window,jQuery),function(a,b){function c(c){var d=[a.location.origin,a.location.pathname];return b(c).parentsUntil(a.document.body).each(function(){d.push(this.tagName)}),d.push(b(c).siblings().andSelf().index(c)),b(c).is("[id]")&&d.push(b(c).attr("id")),d.join("_").replace(/[^0-9a-z_]/gi,"_").toUpperCase()}function d(c,f){e=parseInt(f.time),isNaN(e)||e<=0||a.setTimeout(function(){c.store(),b.isFunction(f.onstore)&&f.onstore.call(c),d(c,f)},parseInt(e))}var e;TinyForm.defaults.storage={name:null,container:a.localStorage,load:!1,time:0,onstore:!1},TinyForm.extend({setup:function(){var a=this,b=a.option.storage;b.name||(b.name=c(a.context)),b.load&&a.load(),d(a,b)},store:function(a){var b=this.getData();return arguments.length>0&&(b=a.call(this,b)),this.option.storage.container.setItem(this.option.storage.name,JSON.stringify(b)),this},load:function(a,c){var d=this.option.storage.container.getItem(this.option.storage.name);if(d)try{d=JSON.parse(d)}catch(a){console.error("无效的数据存储")}return a&&(b.isFunction(c)?this.setData(c.call(this,d)):this.setData(d)),d},abandon:function(){var a=this.option.storage,b=a.container.getItem(a.name);if(a.container.removeItem(a.name),b)try{b=JSON.parse(b)}catch(a){console.error("无效的数据存储")}return b}})}(window,jQuery),function(a,b){function c(a){e(a),a.option.validate.auto&&b.each(a.getField(),function(b){this.blur(function(){a.validate(b)})})}function d(a,c){var d=b.trim(c.attr(o.rule));if(""===d)return[];var e=g(a.context,c,c.attr("name"),c.attr(o.msg)),j=!!e&&f(e,"|");return d.indexOf(":")===-1?h(a.option.validate.rules,d,j):[i(d,j[0])]}function e(a){var c=p[a.id]={};b.each(a.getField(),function(b,e){c[b]=d(a,e),c[b].length||(c[b]=!1)})}function f(a,b,c){if(!a)return[];if(b=b.toString(),a.indexOf(b)===-1)return[a];var d;do d="#"+Math.random().toString().replace(".","")+"#";while(a.indexOf(d)!==-1);var e=new RegExp(d,"g");return c=void 0===c?b:c,b=b.replace(/\|/g,"\\|"),a.replace(new RegExp(b+b,"g"),d).split(new RegExp(b,"g")).map(function(a){return a.replace(e,c)})}function g(a,c,d,e){if(!e)return"";var g;return d&&e.indexOf("&l")!==-1&&(g=b("label[for="+d+"]:first",a).text().replace(/\|/g,"||"),e=f(e,"&l").join(g)),e.indexOf("&p")!==-1&&(g=(c.attr("placeholder")||"").replace(/\|/g,"||"),e=f(e,"&p").join(g)),e}function h(a,c,d){return c.split("|").filter(function(b){return a.hasOwnProperty(b)||"&"===b[0]}).map(function(c){var e=b.extend(!0,{name:c},a[c]);return"&"===c[0]&&(e.rule=c,e.msg="两次输入不一致"),d&&d.length&&(e.msg="string"==typeof d?d:d.shift()),e})}function i(a,b){var c={name:a};return!!a&&(0===a.indexOf("regex:")?(c.rule=new RegExp(a.replace("regex:","")),c.msg=b||"格式不正确",c):0===a.indexOf("length:")?j(a,b):(console.error("不支持的验证规则:"+a),!1))}function j(a,b){var c={name:a},d=a.replace("length:","").split(",");if(1===d.length){var e=parseInt(d[0]);return isNaN(e)||e<0?(console.error('验证规则无效: 长度需要正整数 "'+a+'"'),!1):(c.rule=new RegExp(n.least.rule.replace("{0}",e.toString()),"g"),c.msg=b||n.least.msg.replace("{0}",e.toString()),c)}if(2===d.length){var f=parseInt(d[0]),g=parseInt(d[1]);return(isNaN(f)||f<0||isNaN(g)||g<0)&&console.error('验证规则无效: 长度需要正整数 "'+a+'"'),c.rule=new RegExp(n.between.rule.replace("{0}",f.toString()).replace("{1}",g.toString()),"g"),c.msg=b||n.between.msg.replace("{0}",f.toString()).replace("{1}",g.toString()),c}return console.error("不支持的验证规则:"+a),!1}function k(a,b){var c=a.getField(b);if(!c||0===c.length)return!1;var d=a.getRule(b);return d===!1||l(a,c,a.getData(b),d)}function l(a,c,d,e){var f=!0,g=c.attr("name");if(e===!1||(""===d||0===d.length)&&e.every(function(a){return"required"!==a.name}))return f;for(var h=0;h<e.length;h++){var i=e[h];if(void 0===i||i===!1)return!0;if(b.isFunction(i.rule)){var j=i.rule.call(c,d,g);"string"==typeof j?(f=!1,i.msg=j):j===!1&&(f=!!j)}else"&"===i.rule[0]?f=a.getData(i.rule.substring(1))===d:(i.rule.lastIndex=0,f=i.rule.test(d));var k=a.option.validate.callback;if(b.isFunction(k)){var l=k.call(a,{pass:f,field:c,rule:i.name,name:g,value:d,msg:i.msg.indexOf("&v")!==-1&&c.is("input:not(:checkbox,:radio)")?i.msg.replace(/&v/g,d||""):i.msg});if(void 0!==l&&(f=!!l),a.option.validate.stop&&!f)return!1}else if(a.option.validate.stop&&!f)return!1}return f}var m={required:{rule:function(a){return a=b.trim(a),!!a&&a.length},msg:"不能为空"},number:{rule:/^[0-9]+$/,msg:"请输入数字"},alpha:{rule:/^[a-zA-Z]+$/,msg:"请输入字母"},email:{rule:/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/,msg:"请输入有效的邮箱"},url:{rule:/^[0-9a-z]+(\.[0-9a-z\-_])*\.[\w]+$/i,msg:"请输入有效的网址"}},n={least:{rule:"^.{{0}}.*$",msg:"长度不能少于{0}个字"},equals:{rule:"^.{{0}}$",msg:"长度需要{0}个字"},between:{rule:"^.{{0},{1}}$",msg:"长度应该在{0}到{1}个字之间"}},o={rule:"data-rule",msg:"data-msg"},p={};TinyForm.defaults.validate={auto:!1,stop:!1,callback:function(){},rules:m},TinyForm.extend({setup:function(){c(this)},refresh:function(){c(this)},getRule:function(a){var c=b.extend(!0,{},p[this.id]);return 0===arguments.length?c:0===this.getField(a).length?{}:c[a]},validate:function(a){var b=this;if(arguments.length>0)return"string"==typeof a&&k(b,a);var c={pass:!0,detail:{}},d=b.getField();for(var e in d)if(d.hasOwnProperty(e)){var f=k(b,e);if(!f&&b.option.validate.stop)return!1;c.detail[e]=f,!f&&c.pass&&(c.pass=!1)}return c.pass||c.detail}})}(window,jQuery),$.extend(!0,TinyForm.defaults.validate.rules,{}),TinyForm.version="0.7.8";