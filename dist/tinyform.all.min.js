/**
 * TinyForm 0.7.5  2017-03-24
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinyForm.git
 * @示例: http://hyjiacan.oschina.io/tinyform
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE7及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */
!function(a,b){"use strict";function c(){return"tiny"+(new Date).getTime()+Math.random().toString().substring(2)}function d(b,e){var f=a(b).first(),h=f.attr("data-tinyform");return h&&g.hasOwnProperty(h)||(h=c(),f.attr("data-tinyform",h),g[h]=new d.prototype.setup(f,e,h)),g[h]}function e(b){var c=h[b.id]={},d=a.makeArray(b.option.ignore);b.context.find(b.option.selector).each(function(){var b=a.trim(a(this).attr("name"));if(""!==b&&d.indexOf(b)===-1)return void 0===c[b]||0===c[b].length?void(c[b]=a(this)):a(this).is(":radio")?void c[b].push(this):void console.error('字段的name属性"'+b+'"出现多次，这不对吧')})}var f={setup:[],refresh:[]},g={},h={};d.prototype={constructor:d,setup:function(b,c,g){var h=this;return h.id=g,h.option=a.extend(!0,{},d.defaults,c),h.context=b,e(h),a.each(f.setup,function(){this.call(h)}),h},getField:function(b){var c=a.extend(!0,{},h[this.id]);if(0===arguments.length)return c;if("string"==typeof b){var d=c[b];if(c.hasOwnProperty(b)&&0!==d.length)return d}},refresh:function(){var b=this;return e(b),a.each(f.refresh,function(){this.call(b)}),b}},Object.defineProperty(d,"extend",{configurable:!1,value:function(b){var c=a.extend(!0,{},b);c.hasOwnProperty("setup")&&(f.setup.push(c.setup),delete c.setup),c.hasOwnProperty("refresh")&&(f.refresh.push(c.refresh),delete c.refresh),a.each(c,function(a,b){if(this.hasOwnProperty(a))return void console.error("插件添加方法失败: 此方法已经存在");d.prototype[a]=b})}}),d.defaults={selector:"input[name]:not(:button,:submit,:reset,[data-ignore]), select[name]:not([data-ignore]), textarea[name]:not([data-ignore])",ignore:!1},d.prototype.setup.prototype=d.prototype,b.TinyForm=d}(jQuery,window),function(a,b){"use strict";function c(a,b,c){if(c&&0!==c.length){if(c.is(":radio"))return void c.prop("checked",!1).filter("[value="+b+"]:first").prop("checked",!0);if(c.is(":checkbox"))return void c.prop("checked",b.toString()===a.option.checkbox[0].toString());c.val(b),c.is("select")&&c.change()}}function d(b){var c={};return a.each(b.getField(),function(a){c[a]=e(b,a)}),c}function e(a,b){var c=a.getField(b);return c?c.is("input")?f(a,c):c.val():void console.error('cannot found field "'+b+'"')}function f(a,b){return b.is(":radio")?b.filter(":checked").val():b.is(":checkbox")?b.is(":checked")?a.option.checkbox[0]:a.option.checkbox[1]:b.val()}var g={};a.extend(!0,b.defaults,{checkbox:["on","off"],beforeSubmit:!1}),b.extend({setup:function(){g[this.id]=this.getData()},getData:function(a){if(0===arguments.length)return d(this);if("string"==typeof a)return e(this,a)},setData:function(b,d){var e=this;return 0===arguments.length?(console.error("setData 需要至少1个参数"),e):arguments.length>=2?"string"!=typeof d?e:(c(e,b,e.getField(d)),e):(a.each(e.getField(),function(a,d){var f=b[a];void 0!==f&&null!==f||(f=""),c(e,f,d)}),e)},submit:function(b){var c=this;if(b=a.extend({url:c.context.attr("action"),type:c.context.attr("method")||"post",async:!0,data:c.getData(),cache:!1},b),!a.isFunction(c.option.beforeSubmit)||c.option.beforeSubmit.call(c,b)!==!1)return a.ajax(b)},reset:function(){return a.isFunction(this.context.get(0).reset)?this.context.get(0).reset():this.setData(g[this.id]),this}})}(jQuery,TinyForm),function(a,b,c){"use strict";function d(c){var d=[window.location.origin,window.location.pathname];return b(c).parentsUntil(a.document.body).each(function(){d.push(this.tagName)}),d.push(b(c).siblings().andSelf().index(c)),b(c).is("[id]")&&d.push(b(c).attr("id")),d.join("_").replace(/[^0-9a-z_]/gi,"_").toUpperCase()}function e(c,d){f=parseInt(d.time),isNaN(f)||f<=0||a.setTimeout(function(){c.store(),b.isFunction(d.onstore)&&d.onstore.call(c),e(c,d)},parseInt(f))}var f;c.defaults.storage={name:null,container:a.localStorage,load:!1,time:0,onstore:!1},c.extend({setup:function(){var a=this,b=a.option.storage;b.name||(b.name=d(a.context)),b.load&&a.load(),e(a,b)},store:function(a){var b=this.getData();return this.option.storage.container.setItem(this.option.storage.name,JSON.stringify(b)),arguments.length>0&&a.call(this,b),this},load:function(a,c){var d=this.option.storage.container.getItem(this.option.storage.name);if(d)try{d=JSON.parse(d)}catch(a){console.error("无效的数据存储")}return a&&(b.isFunction(c)?this.setData(c.call(this,d)):this.setData(d)),d},abandon:function(){var a=this.option.storage,b=a.container.getItem(a.name);if(a.container.removeItem(a.name),b)try{b=JSON.parse(b)}catch(a){console.error("无效的数据存储")}return b}})}(window,jQuery,TinyForm),function(a,b){"use strict";function c(b){d(b),b.option.validate.auto&&a.each(b.getField(),function(a){this.blur(function(){b.validate(a)})})}function d(b){var c=n[b.id]={},d=b.option.validate.rules;a.each(b.getField(),function(i,j){var k=a.trim(j.attr(m.rule));if(""===k)return void(c[i]=!1);var l=f(b,j,i,j.attr(m.msg)),n=!!l&&e(l,"|");c[i]=k.indexOf(":")===-1?g(d,k,n):[h(k,n[0])],c[i].length||(c[i]=!1)})}function e(a,b,c){if(!a)return[];if(b=b.toString(),a.indexOf(b)===-1)return[a];var d;do d="#"+Math.random().toString().replace(".","")+"#";while(a.indexOf(d)!==-1);var e=new RegExp(d,"g");return c=void 0===c?b:c,b=b.replace(/\|/g,"\\|"),a.replace(new RegExp(b+b,"g"),d).split(new RegExp(b,"g")).map(function(a){return a.replace(e,c)})}function f(b,c,d,f){if(!f)return"";var g;return f.indexOf("&l")!==-1&&(g=a("label[for="+d+"]:first",b.context).text().replace(/\|/g,"||"),f=e(f,"&l").join(g)),f.indexOf("&p")!==-1&&(g=c.attr("placeholder")||"".replace(/\|/g,"||"),f=e(f,"&p").join(g)),f}function g(b,c,d){return c.split("|").filter(function(a){return b.hasOwnProperty(a)||"&"===a[0]}).map(function(c){var e=a.extend(!0,{name:c},b[c]);return"&"===c[0]&&(e.rule=c),d&&d.length&&(e.msg="string"==typeof d?d:d.shift()),e})}function h(a,b){var c={name:a};return!!a&&(0===a.indexOf("regex:")?(c.rule=new RegExp(a.replace("regex:","")),c.msg=b||"格式不正确",c):0===a.indexOf("length:")?i(a,b):(console.error("不支持的验证规则:"+a),!1))}function i(a,b){var c={name:a},d=a.replace("length:","").split(",");if(1===d.length){var e=parseInt(d[0]);return isNaN(e)||e<0?(console.error('验证规则无效: 长度需要正整数 "'+a+'"'),!1):(c.rule=new RegExp(l.least.rule.replace("{0}",e),"g"),c.msg=b||l.least.msg.replace("{0}",e),c)}if(2===d.length){var f=parseInt(d[0]),g=parseInt(d[1]);return(isNaN(f)||f<0||isNaN(g)||g<0)&&console.error('验证规则无效: 长度需要正整数 "'+a+'"'),c.rule=new RegExp(l.between.rule.replace("{0}",f).replace("{1}",g),"g"),c.msg=b||l.between.msg.replace("{0}",f).replace("{1}",g),c}return console.error("不支持的验证规则:"+a),!1}function j(b,c){var d=b.getField(c);if(!d||0===d.length)return!1;var e=!0,f=b.getRule(c);if(f===!1)return e;var g=b.getData(c)||"";if(f===!1||""===g&&f.every(function(a){return"required"!==a.name}))return e;for(var h=0;h<f.length;h++){var i=f[h];if(void 0===i||i===!1)return!0;if(a.isFunction(i.rule)){var j=i.rule.call(d,g,c);"string"==typeof j?(e=!1,i.msg=j):j===!1&&(e=!!j)}else"&"===i.rule[0]?e=b.getData(i.rule.substring(1))===g:(i.rule.lastIndex=0,e=i.rule.test(g));var k=b.option.validate.callback;if(a.isFunction(k)){var l=k.call(b,{pass:e,field:d,rule:i.name,name:c,value:g,msg:i.msg});if(void 0!==l&&(e=!!l),b.option.validate.stop&&!e)return!1}else if(b.option.validate.stop&&!e)return!1}return e}var k={required:{rule:/^.+$/,msg:"不能为空"},number:{rule:/^[0-9]+$/,msg:"请输入数字"},alpha:{rule:/^[a-zA-Z]+$/,msg:"请输入字母"},email:{rule:/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/,msg:"请输入有效的邮箱"},url:{rule:/^[0-9a-z]+(\.[0-9a-z\-_])*\.[\w]+$/i,msg:"请输入有效的网址"}},l={least:{rule:"^.{{0}}.*$",msg:"长度不能少于{0}个字"},equals:{rule:"^.{{0}}$",msg:"长度需要{0}个字"},between:{rule:"^.{{0},{1}}$",msg:"长度应该在{0}到{1}个字之间"}},m={rule:"data-rule",msg:"data-msg"},n={};b.defaults.validate={auto:!1,stop:!1,callback:function(){},rules:k},b.extend({setup:function(){c(this)},refresh:function(){c(this)},getRule:function(b){var c=a.extend(!0,{},n[this.id]);return 0===arguments.length?c:0===this.getField(b).length?{}:c[b]},validate:function(a){var b=this;if(arguments.length>0)return"string"==typeof a&&j(b,a);var c={pass:!0,detail:{}},d=b.getField();for(var e in d)if(d.hasOwnProperty(e)){var f=j(b,e);if(!f&&b.option.validate.stop)return!1;c.detail[e]=f,!f&&c.pass&&(c.pass=!1)}return c.pass||c.detail}})}(jQuery,TinyForm);