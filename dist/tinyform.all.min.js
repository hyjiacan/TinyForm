!function(t,e){"use strict";function n(){return"tiny"+(new Date).getTime()+Math.random().toString().substring(2)}function r(e,i){var o=t(e).first(),s=o.attr(a);return s&&c.hasOwnProperty(s)||(s=n(),o.attr(a,s),c[s]=new r.prototype.setup(o,i,s)),c[s]}function i(e){var n=l[e.id]={};e.context.find(e.option.selector).each(function(){var e=t.trim(t(this).attr("name"));if(""!==e)return"undefined"==typeof n[e]||0===n[e].length?void(n[e]=t(this)):t(this).is("[type=radio]")?void n[e].push(this):void console.error('控件的name属性"'+e+'"出现多次，这不对吧')})}var o="input[name]:not([type=button][type=submit][type=reset]), select[name], textarea[name]",a="data-tinyform",s="插件添加方法失败: 此方法已经存在",u={setup:[],refresh:[]},c={},l={};r.prototype={constructor:r,setup:function(e,n,r){var a=this;return a.id=r,a.option=t.extend(!0,{selector:o},n),a.context=e,i(a),t.each(u.setup,function(){this.call(a)}),a},getField:function(e){var n=t.extend(!0,{},l[this.id]);if(0===arguments.length)return n;if("string"==typeof e){var r=n[e];if(n.hasOwnProperty(e)&&0!==r.length)return r}},refresh:function(){var e=this;return i(e),t.each(u.refresh,function(){this.call(e)}),e}},Object.defineProperty(r,"extend",{configurable:!1,value:function(e){var n=t.extend(!0,{},e);n.hasOwnProperty("setup")&&(u.setup.push(n.setup),delete n.setup),n.hasOwnProperty("refresh")&&(u.refresh.push(n.refresh),delete n.refresh),t.each(n,function(t,e){return this.hasOwnProperty(t)?void console.error(s):void(r.prototype[t]=e)})}}),r.prototype.setup.prototype=r.prototype,e.TinyForm=r}(jQuery,window),function(t,e){"use strict";function n(t,e,n){if(0!==n.length)return n.is("[type=radio]")?void n.prop("checked",!1).filter("[value="+e+"]:first").prop("checked",!0):n.is("[type=checkbox]")?void n.prop("checked",!!e):void n.val(e)}function r(e){var n={};return t.each(e.getField(),function(t){n[t]=i(e,t)}),n}function i(t,e){var n=t.getField(e);return n.is("input")?o(n):n.val()}function o(t){return t.is("[type=radio]")?t.filter(":checked").val():t.is("[type=checkbox]")?t.is(":checked"):t.val()}var a={};e.extend({setup:function(){a[this.id]=this.getData()},getData:function(t){if(0===arguments.length)return r(this);if("string"==typeof t)return i(this,t)},setData:function(e,r){var i=this;return 0===arguments.length?(console.error("setData 需要至少1个参数"),i):arguments.length>=2?"string"!=typeof r?i:(n(i,e,i.getField(r)),i):(t.each(i.getField(),function(t,r){var o=e[t];"undefined"!=typeof o&&null!==o||(o=""),n(i,o,r)}),i)},submit:function(e){var n=this;return e=t.extend({url:n.context.attr("action"),type:n.context.attr("method")||"post",async:!0,data:n.getData(),cache:!1},e),t.isFunction(n.option.beforeSubmit)&&n.option.beforeSubmit.call(n,e),t.ajax(e),n},reset:function(){return t.isFunction(this.context.get(0).reset)?this.context.get(0).reset():this.setData(a[this.id]),this}})}(jQuery,TinyForm),function(t,e,n){"use strict";function r(n){var r=[window.location.origin,window.location.pathname];return e(n).parentsUntil(t.document.body).each(function(){r.push(this.tagName)}),r.push(e(n).siblings().andSelf().index(n)),e(n).is("[id]")&&r.push(e(n).attr("id")),r.join("_").replace(/[^0-9a-z_]/gi,"_").toUpperCase()}function i(n,r){o=parseInt(r.time),isNaN(o)||o<=0||t.setTimeout(function(){n.store(),e.isFunction(r.onstore)&&r.onstore.call(n),i(n,r)},parseInt(o))}var o,a="无效的数据存储";n.extend({setup:function(){var n=this,o=n.option.storage=e.extend(!0,{container:t.localStorage,load:!1,time:0,onstore:!1,name:r(n.context)},n.option.storage);o.load&&n.load(),i(n,o)},store:function(t){var e=this.getData();return this.option.storage.container.setItem(this.option.storage.name,JSON.stringify(e)),arguments.length>0&&t.call(this,e),this},load:function(t,n){var r=this.option.storage.container.getItem(this.option.storage.name);if(r)try{r=JSON.parse(r)}catch(t){console.error(a)}return t&&(e.isFunction(n)?this.setData(n.call(this,r)):this.setData(r)),r},abandon:function(){var t=this.option.storage,e=t.container.getItem(t.name);if(t.container.removeItem(t.name),e)try{e=JSON.parse(e)}catch(t){console.error(a)}return e}})}(window,jQuery,TinyForm),function(t,e){"use strict";function n(e){var n=p[e.id]={};t.each(e.getField(),function(e,i){var o=t.trim(i.attr(l.rule)),s=i.attr(l.msg);return""===o?void(n[e]=!1):a.hasOwnProperty(o)?(n[e]=t.extend(!0,{},a[o]),void("undefined"!=typeof s&&(n[e].msg=s))):void(n[e]=r(o,s))})}function r(t,e){var n={};return!!t&&(0===t.indexOf("regex:")?(n.rule=new RegExp(t.replace("regex:","")),n.msg=e||"格式不正确",n):0===t.indexOf("length:")?i(t,e):(console.error(u+":"+t),!1))}function i(t,e){var n={},r=t.replace("length:","").split(",");if(1===r.length){var i=parseInt(r[0]);return isNaN(i)||i<0?(console.error(c+' "'+t+'"'),!1):(n.rule=new RegExp(s.least.rule.replace("{0}",i),"g"),n.msg=e||s.least.msg.replace("{0}",i),n)}if(2===r.length){var o=parseInt(r[0]),a=parseInt(r[1]);return(isNaN(o)||o<0||isNaN(a)||a<0)&&console.error(c+' "'+t+'"'),n.rule=new RegExp(s.between.rule.replace("{0}",o).replace("{1}",a),"g"),n.msg=e||s.between.msg.replace("{0}",o).replace("{1}",a),n}return console.error(u+":"+t),!1}function o(e,n){var r=e.getField(n);if(0===r.length)return!1;var i=e.getRule(n);if("undefined"==typeof i||i===!1)return!0;var o=e.getData(n),a=!i.rule||i.rule.test((o||"").toString().replace(/[\r\n]/g," ")),s=e.option.validate.callback;if(!t.isFunction(s))return a;var u=s.call(e,{pass:a,field:r,value:o,msg:i.msg});return"undefined"!=typeof u&&(a=!!u),a}var a={required:{rule:/^.+$/,msg:"不能为空"},number:{rule:/^[0-9]+$/,msg:"请输入数字"},alpha:{rule:/^[a-zA-Z]+$/,msg:"请输入字母"},email:{rule:/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/,msg:"请输入有效的邮箱"},url:{rule:/^[0-9a-z]+(\.[0-9a-z\-_])*\.[\w]+$/i,msg:"请输入有效的网址"}},s={least:{rule:"^.{{0}}.*$",msg:"长度不能少于{0}个字"},equals:{rule:"^.{{0}}$",msg:"长度需要{0}个字"},between:{rule:"^.{{0},{1}}$",msg:"长度应该在{0}到{1}个字之间"}},u="不支持的验证规则",c="验证规则无效: 长度需要正整数",l={rule:"data-rule",msg:"data-msg"},p={};e.extend({setup:function(){var e=this;e.option.validate=t.extend(!0,{auto:!1,stop:!0,callback:function(){}},e.option.validate),n(this),e.option.validate.auto&&t.each(this.getField(),function(t){this.blur(function(){e.validate(t)})})},refresh:function(){n(this)},getRule:function(e){var n=t.extend(!0,{},p[this.id]);return 0===arguments.length?n:0===this.getField(e).length?{}:n[e]},validate:function(t){var e=this;if(arguments.length>0)return"string"==typeof t&&o(e,t);var n={pass:!0,detail:{}},r=e.getField();for(var i in r)if(r.hasOwnProperty(i)){var a=o(e,i);if(!a&&e.option.validate.stop)return!1;n.detail[i]=a,!a&&n.pass&&(n.pass=!1)}return n.pass||n.detail}})}(jQuery,TinyForm);