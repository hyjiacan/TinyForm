/**
 * TinyForm 0.5.0 common 2016-12-08
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinyForm.git
 * @示例: http://hyjiacan.oschina.io/tinyform
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE7及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */
!function(a,b){"use strict";function c(){return"tiny"+(new Date).getTime()+Math.random().toString().substring(2)}function d(b,e){var f=a(b).first(),h=f.attr(g);return h&&j.hasOwnProperty(h)||(h=c(),f.attr(g,h),j[h]=new d.prototype.setup(f,e,h)),j[h]}function e(b){var c=k[b.id]={};b.context.find(b.option.selector).each(function(){var b=a.trim(a(this).attr("name"));if(""!==b)return"undefined"==typeof c[b]||0===c[b].length?void(c[b]=a(this)):a(this).is("[type=radio]")?void c[b].push(this):void console.error('控件的name属性"'+b+'"出现多次，这不对吧')})}var f="input[name]:not([type=button][type=submit][type=reset]), select[name], textarea[name]",g="data-tinyform",h="插件添加方法失败: 此方法已经存在",i={setup:[],refresh:[]},j={},k={};d.prototype={constructor:d,setup:function(b,c,d){var g=this;return g.id=d,g.option=a.extend(!0,{selector:f},c),g.context=b,e(g),a.each(i.setup,function(){this.call(g)}),g},getField:function(b){var c=a.extend(!0,{},k[this.id]);if(0===arguments.length)return c;if("string"==typeof b){var d=c[b];if(c.hasOwnProperty(b)&&0!==d.length)return d}},refresh:function(){var b=this;return e(b),a.each(i.refresh,function(){this.call(b)}),b}},Object.defineProperty(d,"extend",{configurable:!1,value:function(b){var c=a.extend(!0,{},b);c.hasOwnProperty("setup")&&(i.setup.push(c.setup),delete c.setup),c.hasOwnProperty("refresh")&&(i.refresh.push(c.refresh),delete c.refresh),a.each(c,function(a,b){return this.hasOwnProperty(a)?void console.error(h):void(d.prototype[a]=b)})}}),d.prototype.setup.prototype=d.prototype,b.TinyForm=d}(jQuery,window),function(a,b){"use strict";function c(a,b,c){if(0!==c.length)return c.is("[type=radio]")?void c.prop("checked",!1).filter("[value="+b+"]:first").prop("checked",!0):c.is("[type=checkbox]")?void c.prop("checked",!!b):void c.val(b)}function d(b){var c={};return a.each(b.getField(),function(a){c[a]=e(b,a)}),c}function e(a,b){var c=a.getField(b);return c.is("input")?f(c):c.val()}function f(a){return a.is("[type=radio]")?a.filter(":checked").val():a.is("[type=checkbox]")?a.is(":checked"):a.val()}var g={};b.extend({setup:function(){g[this.id]=this.getData()},getData:function(a){if(0===arguments.length)return d(this);if("string"==typeof a)return e(this,a)},setData:function(b,d){var e=this;return 0===arguments.length?(console.error("setData 需要至少1个参数"),e):arguments.length>=2?"string"!=typeof d?e:(c(e,b,e.getField(d)),e):(a.each(e.getField(),function(a,d){var f=b[a];"undefined"!=typeof f&&null!==f||(f=""),c(e,f,d)}),e)},submit:function(b){var c=this;return b=a.extend({url:c.context.attr("action"),type:c.context.attr("method")||"post",async:!0,data:c.getData(),cache:!1},b),a.isFunction(c.option.beforeSubmit)&&c.option.beforeSubmit.call(c,b),a.ajax(b),c},reset:function(){return a.isFunction(this.context.get(0).reset)?this.context.get(0).reset():this.setData(g[this.id]),this}})}(jQuery,TinyForm),function(a,b){"use strict";function c(b){var c=l[b.id]={};a.each(b.getField(),function(b,e){var f=a.trim(e.attr(k.rule)),h=e.attr(k.msg);return""===f?void(c[b]=!1):g.hasOwnProperty(f)?(c[b]=a.extend(!0,{},g[f]),void("undefined"!=typeof h&&(c[b].msg=h))):void(c[b]=d(f,h))})}function d(a,b){var c={};return!!a&&(0===a.indexOf("regex:")?(c.rule=new RegExp(a.replace("regex:","")),c.msg=b||"格式不正确",c):0===a.indexOf("length:")?e(a,b):(console.error(i+":"+a),!1))}function e(a,b){var c={},d=a.replace("length:","").split(",");if(1===d.length){var e=parseInt(d[0]);return isNaN(e)||e<0?(console.error(j+' "'+a+'"'),!1):(c.rule=new RegExp(h.least.rule.replace("{0}",e),"g"),c.msg=b||h.least.msg.replace("{0}",e),c)}if(2===d.length){var f=parseInt(d[0]),g=parseInt(d[1]);return(isNaN(f)||f<0||isNaN(g)||g<0)&&console.error(j+' "'+a+'"'),c.rule=new RegExp(h.between.rule.replace("{0}",f).replace("{1}",g),"g"),c.msg=b||h.between.msg.replace("{0}",f).replace("{1}",g),c}return console.error(i+":"+a),!1}function f(b,c){var d=b.getField(c);if(0===d.length)return!1;var e=b.getRule(c);if("undefined"==typeof e||e===!1)return!0;var f=b.getData(c),g=!e.rule||e.rule.test((f||"").toString().replace(/[\r\n]/g," ")),h=b.option.validate.callback;if(!a.isFunction(h))return g;var i=h.call(b,{pass:g,field:d,value:f,msg:e.msg});return"undefined"!=typeof i&&(g=!!i),g}var g={required:{rule:/^.+$/,msg:"不能为空"},number:{rule:/^[0-9]+$/,msg:"请输入数字"},alpha:{rule:/^[a-zA-Z]+$/,msg:"请输入字母"},email:{rule:/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/,msg:"请输入有效的邮箱"},url:{rule:/^[0-9a-z]+(\.[0-9a-z\-_])*\.[\w]+$/i,msg:"请输入有效的网址"}},h={least:{rule:"^.{{0}}.*$",msg:"长度不能少于{0}个字"},equals:{rule:"^.{{0}}$",msg:"长度需要{0}个字"},between:{rule:"^.{{0},{1}}$",msg:"长度应该在{0}到{1}个字之间"}},i="不支持的验证规则",j="验证规则无效: 长度需要正整数",k={rule:"data-rule",msg:"data-msg"},l={};b.extend({setup:function(){var b=this;b.option.validate=a.extend(!0,{auto:!1,stop:!0,callback:function(){}},b.option.validate),c(this),b.option.validate.auto&&a.each(this.getField(),function(a){this.blur(function(){b.validate(a)})})},refresh:function(){c(this)},getRule:function(b){var c=a.extend(!0,{},l[this.id]);return 0===arguments.length?c:0===this.getField(b).length?{}:c[b]},validate:function(a){var b=this;if(arguments.length>0)return"string"==typeof a&&f(b,a);var c={pass:!0,detail:{}},d=b.getField();for(var e in d)if(d.hasOwnProperty(e)){var g=f(b,e);if(!g&&b.option.validate.stop)return!1;c.detail[e]=g,!g&&c.pass&&(c.pass=!1)}return c.pass||c.detail}})}(jQuery,TinyForm);