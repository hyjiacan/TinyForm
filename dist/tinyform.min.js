/**
 * TinyForm 0.4.2 2016-11-30
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinyForm.git
 * @示例: http://hyjiacan.oschina.io/tinyform
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE7及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */
!function(a,b){"use strict";function c(b,d){var e=a(b).first(),f=e.attr("data-tiny-id");return f&&h.hasOwnProperty(f)||(f="tiny"+Math.random().toString().substring(2),e.attr("data-tiny-id",f),h[f]=new c.prototype.setup(e,d),h[f].id=f),h[f]}function d(b){b._cache.fields={},b.context.find(b.option.fieldSelector).each(function(){var c=a.trim(a(this).attr("name"));if(""!==c)return"undefined"==typeof b._cache.fields[c]&&(b._cache.fields[c]=[]),0===b._cache.fields[c].length?void b._cache.fields[c].push(a(this)):a(this).is("[type=radio]")?void b._cache.fields[c].push(a(this)):void console.error('控件的name属性"'+c+'"出现多次，这不对吧')})}var e="input[name]:not([type=button][type=submit][type=reset]), select[name], textarea[name]",f=[],g=[],h={};c.prototype={constructor:c,setup:function(b,c){var d=this;return d.option=a.extend(!0,{autoValidate:!1,stopOnFail:!0,fieldSelector:e},c),d.context=b,d._cache={fields:{}},a.each(f,function(){this.call(d)}),this.refresh(),d},getField:function(b){var c=a.extend(!0,{},this._cache.fields);if(0===arguments.length)return c;if("string"==typeof b){var d=c[b];return c.hasOwnProperty(b)&&0!==d.length?d:[]}},refresh:function(){var b=this;return d(b),a.each(g,function(){this.call(b)}),b}},Object.defineProperty(c,"extend",{configurable:!1,value:function(b){var d=a.extend(!0,{},b);d.hasOwnProperty("setup")&&(f.push(d.setup),delete d.setup),d.hasOwnProperty("refresh")&&(g.push(d.refresh),delete d.refresh),a.extend(!0,c.prototype,d)}}),c.prototype.setup.prototype=c.prototype,b.TinyForm=c}(jQuery,window),function(a,b){"use strict";function c(b,c,d){(a.isArray(d)||(d=b.getField(d),a.isArray(d)&&0!==d.length))&&a.each(d,function(b,d){return d=a(d),d.is("input")?void(d.is("[type=radio]")?d.prop("checked",(d.val()||"").toString()===c.toString()):d.is("[type=checkbox]")?d.prop("checked",c):d.val(c)):void d.val(c)})}function d(b){var c={};return a.each(b.getField(),function(a,d){c[a]=e(b,a)}),c}function e(a,b){var c=a.getField(b);return c[0].is("input")?f(c):c[0].is("select[multiple]")?c[0].val()||[]:c[0].val()}function f(a){var b="",c=a[0];if(c.is("[type=radio]")){for(var d=0;d<a.length;d++)if(c=a[d],c.is(":checked")){b=c.val();break}return b}return c.is("[type=checkbox]")?c.is(":checked"):c.val()}b.extend({setup:function(){this._oriData=this.getData()},getData:function(a){var b=this;if(0===arguments.length)return d(b);if("string"==typeof a)return e(b,a)},setData:function(b,d){var e=this;return 0===arguments.length?(console.error("setData 需要至少1个参数"),e):arguments.length>=2?"string"!=typeof d?e:(c(e,b,d),e):(a.each(e.getField(),function(a,d){var f=b[a];"undefined"!=typeof f&&null!==f||(f=""),c(e,f,d)}),e)},submit:function(b){var c=this;return b=a.extend({url:c.context.attr("action"),type:c.context.attr("method")||"post",async:!0,data:{},success:!1,error:!1,cache:!1},b),b.data=a.extend({},b.data,c.getData()),a.isFunction(c.option.beforeSubmit)&&c.option.beforeSubmit.call(c,b),a.ajax(b),c},reset:function(){return a.isFunction(this.context.get(0).reset)?this.context.get(0).reset():this.setData(this._oriData),this}})}(jQuery,TinyForm),function(a,b,c){"use strict";function d(c){var d=[window.location.origin,window.location.pathname];return b(c).parentsUntil(a.document.body).each(function(){d.push(this.tagName)}),d.push(b(c).siblings().andSelf().index(c)),b(c).is("[id]")&&d.push(b(c).attr("id")),d.join("_").replace(/[^0-9a-z_]/gi,"_").toUpperCase()}c.extend({setup:function(){var c=this;c.option=b.extend(!0,{storage:a.localStorage,autoload:!1,interval:0,onstore:!1},c.option),Object.defineProperty(this.option,"uniquepath",{configurable:!1,writable:!1,value:d(c.context)}),c.option.autoload&&c.load(),c.option.interval&&a.setInterval(function(){c.store(),b.isFunction(c.option.onstore)&&c.option.onstore.call(c)},parseInt(c.option.interval))},store:function(a){var b=this.getData();return arguments.length&&(b=a.call(this,b)),this.option.storage.setItem(this.option.uniquepath,JSON.stringify(b)),this},load:function(a,c){var d=this.option.storage.getItem(this.option.uniquepath);if(d)try{d=JSON.parse(d)}catch(a){console.error("存储不是有效的JSON数据")}return a&&(b.isFunction(c)?this.setData(c.call(this,d)):this.setData(d)),d},abandon:function(){var a=this.option.storage.getItem(this.option.uniquepath);if(this.option.storage.removeItem(this.option.uniquepath),a)try{a=JSON.parse(a)}catch(a){}return a}})}(window,jQuery,TinyForm),function(a,b){"use strict";function c(b,c){a.each(b.getField(c),function(a,d){d.blur(function(){b.validate(c)})})}function d(b){b._cache.rules={},a.each(b.getField(),function(c,d){var f=a.trim(d[0].attr(i.rule)),g=d[0].attr(i.msg);return""===f?void(b._cache.rules[c]=!1):h.hasOwnProperty(f)?(b._cache.rules[c]=a.extend(!0,{},h[f]),void("undefined"!=typeof g&&(b._cache.rules[c].msg=g))):void(b._cache.rules[c]=e(f,g))})}function e(a,b){var c={};if(!a)return!1;if(0===a.indexOf("regex:"))try{return c.rule=new RegExp(a.replace("regex:","")),c.msg=b||"格式不正确",c}catch(a){return!1}return 0===a.indexOf("length:")&&f(a,b)}function f(a,b){var c={},d=a.replace("length:","").split(",");return 1===d.length?(d[0]=parseInt(d[0]),isNaN(d[0])||d[0]<0?(console.error('验证规则无效: 长度需要正整数 "'+a+'"'),!1):(c.rule=new RegExp("^.{"+d[0]+"}.*$","g"),c.msg=b||"长度不能少于"+d[0]+"个字",c)):2===d.length&&(d[0]=parseInt(d[0]),d[1]=parseInt(d[1]),isNaN(d[0])||d[0]<0||isNaN(d[1])||d[1]<0?(console.error('验证规则无效: 长度需要正整数 "'+a+'"'),!1):d[0]===d[1]?(c.rule=new RegExp("^.{"+d[0]+"}$","g"),c.msg=b||"长度需要"+d[0]+"个字",c):(c.rule=new RegExp("^.{"+d[0]+","+d[1]+"}$","g"),c.msg=b||"长度应该在"+d[0]+"到"+d[1]+"个字之间",c))}function g(b,c){var d=b.getField(c);if(0===d.length)return!1;var e=b.getRule(c);if("undefined"==typeof e||e===!1)return!0;var f=b.getData(c),g=!e.rule||e.rule.test((f||"").toString().replace(/[\r\n]/g," "));if(!a.isFunction(b.option.afterValidate))return g;var h=b.option.afterValidate.call(b,{pass:g,field:d,value:f,msg:g?"":e.msg});return"undefined"!=typeof h&&(g=!!h),g}var h={required:{rule:/^.+$/,msg:"不能为空"},number:{rule:/^[0-9]+$/,msg:"请输入数字"},alpha:{rule:/^[a-zA-Z]+$/,msg:"请输入字母"},email:{rule:/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/,msg:"请输入有效的邮箱"},url:{rule:/^[0-9a-z]+(\.[0-9a-z\-_])*\.[\w]+$/i,msg:"请输入有效的网址"}},i={rule:"data-rule",msg:"data-msg"};b.extend({setup:function(){var b=this;b._cache.rules={},b.option.autoValidate&&a.each(this.getField(),function(a){c(b,a)})},refresh:function(){d(this)},getRule:function(b){var c=a.extend(!0,{},this._cache.rules);return 0===arguments.length?c:0===this.getField(b).length?{}:c[b]},validate:function(a){var b=this;if(arguments.length>0)return"string"==typeof a&&g(b,a);var c={pass:!0,detail:{}},d=b.getField();for(var e in d)if(d.hasOwnProperty(e)){var f=g(b,e);if(!f&&b.option.stopOnFail)return!1;c.detail[e]=f,!f&&c.pass&&(c.pass=!1)}return c.pass||c.detail}})}(jQuery,TinyForm);