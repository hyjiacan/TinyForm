/**
 * TinyForm-core@0.7.6  2017-04-12
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinyForm.git
 * @示例: http://hyjiacan.oschina.io/tinyform
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE7及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

(function(win, $){
"use strict";
!function(a,b){"use strict";function c(){return"tiny"+(new Date).getTime()+Math.random().toString().substring(2)}function d(a,e){var f=b(a).first(),g=f.attr("data-tinyform");return g&&k.hasOwnProperty(g)||(g=c(),f.attr("data-tinyform",g),k[g]=new d.prototype.setup(f,e,g)),k[g]}function e(a){var c=l[a.id]={},d=b.makeArray(a.option.ignore);a.context.find(a.option.selector).each(function(){var a=b.trim(b(this).attr("name"));if(""!==a&&d.indexOf(a)===-1)return void 0===c[a]||0===c[a].length?void(c[a]=b(this)):b(this).is(":radio")?void c[a].push(this):void console.error('字段的name属性"'+a+'"出现多次，这不对吧')})}function f(a,b,c){if(c&&0!==c.length){if(c.is(":radio"))return void c.prop("checked",!1).filter("[value="+b+"]:first").prop("checked",!0);if(c.is(":checkbox"))return void c.prop("checked",b.toString()===a.option.checkbox[0].toString());c.val(b),c.is("select")&&c.change()}}function g(a){var c={};return b.each(a.getField(),function(b){c[b]=h(a,b)}),c}function h(a,b){var c=a.getField(b);return c?c.is("input")?i(a,c):c.val():void console.error('cannot found field "'+b+'"')}function i(a,b){return b.is(":radio")?b.filter(":checked").val():b.is(":checkbox")?b.is(":checked")?a.option.checkbox[0]:a.option.checkbox[1]:b.val()}var j={setup:[],refresh:[]},k={},l={};d.prototype={constructor:d,setup:function(a,c,f){var g=this;return g.id=f,g.option=b.extend(!0,{},d.defaults,c),g.context=a,e(g),b.each(j.setup,function(){this.call(g)}),g},getField:function(a){var c=b.extend(!0,{},l[this.id]);if(0===arguments.length)return c;if("string"==typeof a){var d=c[a];if(c.hasOwnProperty(a)&&0!==d.length)return d}},refresh:function(){var a=this;return e(a),b.each(j.refresh,function(){this.call(a)}),a}},Object.defineProperty(d,"extend",{configurable:!1,value:function(a){var c=this;b.each(a,function(a,b){return j.hasOwnProperty(a)?void j[a].push(b):c.hasOwnProperty(a)?void console.error("插件添加方法失败: 此方法已经存在"):void(d.prototype[a]=b)})}}),d.defaults={selector:"input[name]:not(:button,:submit,:reset,[data-ignore]), select[name]:not([data-ignore]), textarea[name]:not([data-ignore])",ignore:!1},d.prototype.setup.prototype=d.prototype,a.TinyForm=d,d.get=function(a){return a?k[a]:b.extend(!0,{},k)};var m={};b.extend(!0,d.defaults,{checkbox:["on","off"],beforeSubmit:!1}),d.extend({setup:function(){m[this.id]=this.getData()},getData:function(a){if(0===arguments.length)return g(this);if("string"==typeof a)return h(this,a)},setData:function(a,c){var d=this;return 0===arguments.length?(console.error("setData 需要至少1个参数"),d):arguments.length>=2?"string"!=typeof c?d:(f(d,a,d.getField(c)),d):(b.each(d.getField(),function(b,c){var e=a[b];void 0!==e&&null!==e||(e=""),f(d,e,c)}),d)},submit:function(a){var c=this;if(a=b.extend({url:c.context.attr("action"),type:c.context.attr("method")||"post",async:!0,data:c.getData(),cache:!1},a),!b.isFunction(c.option.beforeSubmit)||c.option.beforeSubmit.call(c,a)!==!1)return b.ajax(a)},reset:function(){return b.isFunction(this.context.get(0).reset)?this.context.get(0).reset():this.setData(m[this.id]),this}})}(window,jQuery);