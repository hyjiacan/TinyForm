/**
 * TinyForm-core@0.7.7  2017-05-25
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinyForm.git
 * @示例: http://hyjiacan.oschina.io/tinyform
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE8及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */

!function(a,b){function c(){return"tiny"+(new Date).getTime()+Math.random().toString().substring(2)}function d(a,e){var g=b(a).first(),i=g.attr(f);return i&&h.hasOwnProperty(i)||(i=c(),g.attr(f,i),h[i]=new d.prototype.setup(g,e,i)),h[i]}function e(a){var c=i[a.id]={},d=b.makeArray(a.option.ignore);a.context.find(a.option.selector).each(function(){var a=b.trim(b(this).attr("name"));if(""!==a&&-1===d.indexOf(a))return void 0===c[a]||0===c[a].length?void(c[a]=b(this)):b(this).is(":radio")?void c[a].push(this):void console.error('字段的name属性"'+a+'"出现多次，这不对吧')})}var f="data-tinyform",g={setup:[],refresh:[]},h={},i={};d.prototype={constructor:d,setup:function(a,c,f){var h=this;return h.id=f,h.option=b.extend(!0,{},d.defaults,c),h.context=a,e(h),b.each(g.setup,function(){this.call(h)}),h},getField:function(a){var c=b.extend(!0,{},i[this.id]);if(0===arguments.length)return c;if("string"==typeof a){var d=c[a];if(c.hasOwnProperty(a)&&0!==d.length)return d}},refresh:function(){var a=this;return e(a),b.each(g.refresh,function(){this.call(a)}),a}},Object.defineProperty(d,"extend",{configurable:!1,value:function(a){var c=this;b.each(a,function(a,b){return g.hasOwnProperty(a)?void g[a].push(b):c.hasOwnProperty(a)?void console.error("插件添加方法失败: 此方法已经存在"):void(d.prototype[a]=b)})}}),d.defaults={selector:"input[name]:not(:button,:submit,:reset,[data-ignore]"+(window.FormData?"":",[type=file]")+"), select[name]:not([data-ignore]), textarea[name]:not([data-ignore])",ignore:!1,jquery3:!1},d.prototype.setup.prototype=d.prototype,a.TinyForm=d,d.get=function(a){return a?h[a]:b.extend(!0,{},h)}}(window,jQuery),function(a,b){function c(a,c,d){if(d&&0!==d.length)return null!==c&&void 0!==c||(c=""),d.is(":radio")?void d.prop("checked",!1).each(function(){if(b(this).val()===c)return b(this).prop("checked",!0),!1}):d.is(":checkbox")?void d.prop("checked",c.toString()===a.option.checkbox[0].toString()):void(d.is("select")?(d.val(c),d.change()):d.val(c.toString()))}function d(a){var c={};return b.each(a.getField(),function(b){c[b]=e(a,b)}),c}function e(a,b){var c=a.getField(b);if(!c)return void console.error('cannot found field "'+b+'"');if(c.is("input"))return f(a,c);if(a.option.jquery3&&c.is("select[multiple]")){var d=c.val();return 0===d.length?null:d}return c.val()}function f(a,b){return b.is(":radio")?b.filter(":checked").val():b.is(":checkbox")?b.is(":checked")?a.option.checkbox[0]:a.option.checkbox[1]:b.val()}var g={};b.extend(!0,TinyForm.defaults,{checkbox:["on","off"],beforeSubmit:!1}),TinyForm.extend({setup:function(){g[this.id]=this.getData()},getData:function(a){if(0===arguments.length)return d(this);if("string"==typeof a)return e(this,a)},setData:function(a,d){var e=this;return 0===arguments.length?(console.error("setData 需要至少1个参数"),e):arguments.length>=2?"string"!=typeof d?e:(c(e,a,e.getField(d)),e):(b.each(e.getField(),function(b,d){var f=a[b];void 0!==f&&null!==f||(f=""),c(e,f,d)}),e)},submit:function(a){var c=this;if(a=b.extend({url:c.context.attr("action"),type:c.context.attr("method")||"post",async:!0,data:c.getData(),cache:!1},a),!b.isFunction(c.option.beforeSubmit)||!1!==c.option.beforeSubmit.call(c,a))return b.ajax(a)},reset:function(){return b.isFunction(this.context.get(0).reset)?this.context.get(0).reset():this.setData(g[this.id]),this}})}(window,jQuery),TinyForm.version="0.7.7";