/**
 * TinyForm 0.3.0 2016-11-28
 * @作者: hyjiacan
 * @源码: https://git.oschina.net/hyjiacan/TinyForm.git
 * @示例: http://hyjiacan.oschina.io/tinyform
 * @许可协议: MIT
 * @依赖: jQuery 1.8.0及更高版本
 * @浏览器支持: 不支持IE7及更低版本
 * @QQ群: 187786345 (Javascript爱好者)
 */
!function(a,b){"use strict";function c(b,d){var e=a(b).first(),f=e.attr("data-tiny-id");return f&&j.hasOwnProperty(f)||(f="tiny"+Math.random().toString().substring(2),e.attr("data-tiny-id",f),j[f]=new c.prototype.setup(e,d)),j[f]}function d(b){a.each(b._cache.fields,function(a,b){b.length=0}),b.context.find(b.option.fieldSelector).each(function(){var c=a.trim(a(this).attr("name"));if(""!==c)return"undefined"==typeof b._cache.fields[c]&&(b._cache.fields[c]=[]),0===b._cache.fields[c].length?void b._cache.fields[c].push(a(this)):a(this).is("[type=radio]")?void b._cache.fields[c].push(a(this)):void console.error('控件的name属性"'+c+'"出现多次，这不对吧')})}var e="input[name]:not([type=button][type=submit][type=reset]), select[name], textarea[name]",f="找不到此控件: ",g="需要字符串",h=[],i=[],j={};c.prototype={constructor:c,setup:function(b,c){var d=this;return d.option=a.extend(!0,{autoValidate:!1,stopOnFail:!0,fieldSelector:e},c),d.context=b,this._cache={fields:{}},a.each(h,function(){this.call(d)}),this.refresh(),d},getField:function(b){var c=a.extend(!0,{},this._cache.fields);if(0===arguments.length)return c;if("string"!=typeof b)return void console.error(g);var d=c[b];return c.hasOwnProperty(b)&&0!==d.length?d:(console.error(f+b),[])},refresh:function(){var b=this;return d(b),a.each(i,function(){this.call(b)}),b}},Object.defineProperty(c,"extend",{configurable:!1,value:function(b){var d=a.extend(!0,{},b);d.hasOwnProperty("setup")&&(h.push(d.setup),delete d.setup),d.hasOwnProperty("refresh")&&(i.push(d.refresh),delete d.refresh),a.extend(!0,c.prototype,d)}}),c.prototype.setup.prototype=c.prototype,b.TinyForm=c}(jQuery,window),function(a,b){"use strict";function c(b,c,d){return a.isArray(d)||(d=b.getField(d),a.isArray(d)&&0!==d.length)?void a.each(d,function(b,d){return d=a(d),d.is("input")?void(d.is("[type=radio]")?d.prop("checked",(d.val()||"").toString()===c.toString()):d.is("[type=checkbox]")?d.prop("checked",c):d.val(c)):void d.val(c)}):void console.error(CONTROL_NOT_FOUND+f)}function d(b){var c={};return a.each(b._cache.fields,function(a,d){c[a]=e(b,d)}),c}function e(b,c){return a.isArray(c)||(c=b._cache.fields[c],a.isArray(c)&&0!==c.length)?c[0].is("input")?g(c):c[0].is("select[multiple]")?c[0].val()||[]:c[0].val():(console.error(CONTROL_NOT_FOUND+f),"")}function g(a){var b="",c=a[0];if(c.is("[type=radio]")){for(var d=0;d<a.length;d++)if(c=a[d],c.is(":checked")){b=c.val();break}return b}return c.is("[type=checkbox]")?c.is(":checked"):c.val()}b.extend({setup:function(){this.originData=this.getData()},getData:function(a){var b=this;return 0===arguments.length?d(b):"string"!=typeof a?void console.error(STR_REQUIRED):e(b,a)},setData:function(b,d){var e=this;return 0===arguments.length?(console.error("setData 需要至少1个参数"),e):arguments.length>=2?"string"!=typeof d?(console.error(STR_REQUIRED),e):(c(e,b,d),e):(a.each(e._cache.fields,function(a,d){var f=b[a];"undefined"!=typeof f&&null!==f||(f=""),c(e,f,d)}),e)},submit:function(b){var c=this;return b=a.extend({url:c.context.attr("action"),type:c.context.attr("method")||"post",async:!0,data:{},success:!1,error:!1,cache:!1},b),b.data=a.extend({},b.data,c.getData()),a.isFunction(c.option.beforeSubmit)&&c.option.beforeSubmit.call(c,b),a.ajax(b),c},reset:function(){return a.isFunction(this.context.get(0).reset)?this.context.get(0).reset():this.setData(this.originData),this}})}(jQuery,TinyForm),function(a,b){"use strict";function c(b,c){a.each(b._cache.fields[c],function(a,d){d.blur(function(){b.validate(c)})})}function d(b){a.each(b._cache.rules,function(a){delete b._cache.rules[a]}),a.each(b._cache.fields,function(c,d){var f=a.trim(d[0].attr(j.rule)),g=d[0].attr(j.msg);return""===f?void(b._cache.rules[c]=!1):i.hasOwnProperty(f)?(b._cache.rules[c]=a.extend(!0,{},i[f]),void("undefined"!=typeof g&&(b._cache.rules[c].msg=g))):void(b._cache.rules[c]=e(f,g))})}function e(a,b){var c={};if(!a)return!1;if(0===a.indexOf("regex:"))try{return c.rule=new RegExp(a.replace("regex:","")),c.msg=b||"格式不正确",c}catch(a){return!1}return 0===a.indexOf("length:")&&g(a,b)}function g(a,b){var c={},d=a.replace("length:","").split(",");return 1===d.length?(d[0]=parseInt(d[0]),isNaN(d[0])||d[0]<0?(console.error('验证规则无效: 长度需要正整数 "'+a+'"'),!1):(c.rule=new RegExp("^.{"+d[0]+"}.*$","g"),c.msg=b||"长度不能少于"+d[0]+"个字",c)):2===d.length&&(d[0]=parseInt(d[0]),d[1]=parseInt(d[1]),isNaN(d[0])||d[0]<0||isNaN(d[1])||d[1]<0?(console.error('验证规则无效: 长度需要正整数 "'+a+'"'),!1):d[0]===d[1]?(alidation.rule=new RegExp("^.{"+d[0]+"}$","g"),c.msg=b||"长度需要"+d[0]+"个字",c):(c.rule=new RegExp("^.{"+d[0]+","+d[1]+"}$","g"),c.msg=b||"长度应该在"+d[0]+"到"+d[1]+"个字之间",c))}function h(b,c){var d=b.getField(c);if(0===d.length)return console.error(CONTROL_NOT_FOUND+f),!1;var e=b._cache.rules[c];if("undefined"==typeof e||e===!1)return!0;var g=b.getData(c),h=!e.rule||e.rule.test((g||"").toString().replace(/[\r\n]/g," "));if(!a.isFunction(b.option.afterValidate))return h;var i=b.option.afterValidate.call(b,{pass:h,field:d,value:g,msg:h?"":e.msg});return"undefined"!=typeof i&&(h=!!i),h}var i={required:{rule:/^.+$/,msg:"不能为空"},number:{rule:/^[0-9]+$/,msg:"请输入数字"},alpha:{rule:/^[a-zA-Z]+$/,msg:"请输入字母"},email:{rule:/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/,msg:"请输入有效的邮箱"},url:{rule:/^[0-9a-z]+(\.[0-9a-z\-_])*\.[\w]+$/i,msg:"请输入有效的网址"}},j={rule:"data-rule",msg:"data-msg"};b.extend({setup:function(){var b=this;b._cache.rules={},b.option.autoValidate&&a.each(this._cache.fields,function(a){c(b,a)})},refresh:function(){d(this)},getRule:function(b){var c=a.extend(!0,{},this._cache.rules);return 0===arguments.length?c:0===this.getField(b).length?{}:c[b]},validate:function(a){var b=this;if(arguments.length>0)return"string"!=typeof a?(console.error(STR_REQUIRED),!1):h(b,a);var c={pass:!0,detail:{}},d=b.getField();for(var e in d)if(d.hasOwnProperty(e)){var f=h(b,e);if(!f&&b.option.stopOnFail)return!1;c.detail[e]=f,!f&&c.pass&&(c.pass=!1)}return c.pass||c.detail}})}(jQuery,TinyForm);